<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
      <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
      <meta content="utf-8" http-equiv="encoding">
      <title>VRSpace:MonsterCave</title>
      ﻿<style type="text/css">
      html, body {
        width: 100%;
        height:100%;
        margin: 0px;
        padding: 0px;
      }
      canvas {
        width: 98%;
        height:96%;
        padding-left: 0;
        padding-right: 0;
        margin-left: auto;
        margin-right: auto;
        display: block;
      }
      </style>﻿
      <script src="https://cdn.babylonjs.com/babylon.js"></script>
      <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
      <script src="/babylon/js/vrspace-min.js" type="module"></script>
      <script src="https://cdn.babylonjs.com/gui/babylon.gui.js"></script>
    </head>
  <body>

    <canvas id="renderCanvas" touch-action="none"></canvas>

<script>
var canvas = document.getElementById("renderCanvas"); // Get the canvas element
var engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine
var scene;

import("./world.js").then( (module) =>{
  
  var cave = module.WORLD;
  cave.init(engine, 'cave').then((s) => {
    scene = s;

    // Step3: now that the scene is created, connect to the server
    // note that you can load all scripts from demo server
    import('/babylon/js/vrspace-min.js').then(ui => {
      var net = new ui.WorldManager(cave);
      
      // RECOMMENDED: set world name
      // all users in the same world share same events
      cave.name = 'cave';
      var characterUrl = '/content/char/male/male_adventurer/scene.gltf';
      net.createAvatarFromUrl( characterUrl ).then( avatar => {
    	  avatar.load( () => {
    		  let controller = new ui.AvatarController(net, avatar);
          net.addMyChangeListener( changes => controller.processChanges(changes) );
    	  });
      });
      
      // connect, set own avatar and start the session
      net.enter({
        // RECOMMENDED set your avatar url, or be invisible
        mesh:characterUrl, 
        // OPTIONAL set your name, MUST be unique
        name:'player'+Math.random()
      });
      
      
    });
  });
  
})

// Watch for browser/canvas resize events
window.addEventListener("resize", function () {
    engine.resize();
});

function debugOnOff() {
  console.log("Debug: "+scene.debugLayer.isVisible());
  if ( scene.debugLayer.isVisible() ) {
    scene.debugLayer.hide();
  } else {
    scene.debugLayer.show();
  }
}

</script>
<div style="position:absolute;bottom:10px;right:50%;">
<button onClick="debugOnOff()">Debug</button>
</div>
</body>
</html>
